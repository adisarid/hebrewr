# '爪转 {#sec-ggplot2}

'爪转   拽专  转拽砖专 砖 转 (抓 ,  驻转 ). 驻专拽    驻拽 '爪转 爪注转 转 `ggplot2`.

转 `ggplot2` 住住转 注 转专 砖拽专转 拽拽 砖 专驻拽 [@wickham2010]. 注拽专转 转专  转 拽 住   砖  专祝. 拽 :

1.   砖转 驻 驻 住 注 专祝 ("住拽"), , 砖转  转 驻 爪专 X 爪专 Y,   转 驻 爪注, , 砖拽驻转, 爪专, 注.
2.  专 驻 转住驻转 砖转 砖拽专转 专转. 砖 专转 专转  拽注转 爪 专 专祝,  拽转 (专转 驻专), 拽, 注转 (bars), 专 (tiles), 拽驻住转 转驻转 (boxplots), 注.
3.  住祝 砖 注 专祝 注 "拽砖"  转专转, 拽专, 爪专,   砖专砖 砖 砖专  转 专转 转 专转.

转 `ggplot2` 砖 注砖专转 专转 砖 专转,  驻砖专转 砖转 专转 爪专 注  专祝 砖转爪专.

 转 注转 住 转 砖 驻, 转 砖 砖转砖 '爪转 注 转   拽砖专  专 专 拽专.

## 住住

转 专祝 驻砖, 转拽  住专 砖 专驻. 专砖转 注 转 转 专砖转  驻专拽, 专 转 转 -- 注爪 专驻 -- 砖 砖转砖 (住专 住祝 注 转转 砖 驻专拽 ).

```{r penguins package load}
#| warning: false
#| message: false
library(palmerpenguins)
library(tidyverse)
ggplot2::theme_set(ggplot2::theme_bw())
```

```{r penguins vis 1}
penguins %>% 
  ggplot(aes(x = bill_length_mm,
             y = bill_depth_mm)) + 
  geom_point()
```

专砖转 转 转 爪,  转  拽砖专 砖注转.  住转 专 砖注 砖转 bill_length_mm 注 注 专 砖转 bill_depth_mm (  砖转拽 爪专 -x 砖 专 拽 砖 转爪驻转 爪专 -y).  住拽 砖, 转祝  ,  驻 , 注 住驻专 住专:

注转 专 砖驻注 注 专祝 注转 转 砖砖 砖转 砖专转 砖 转   转专砖 砖 注专 住专 (住专 转 注 专  注拽  砖).

注 转专:

-   驻拽爪 `ggplot` 专 转专砖.

-   专 专砖 砖   注爪 (`penguins`), 砖住 爪注转 驻专专 `%>%`.

-   专 砖 住 驻拽爪 `aes()` 砖专 住拽转. 拽专  专 砖 驻 住拽转, 爪专 x 爪专 y.

-   专  砖 专 `+` 注 转 住祝 砖 砖 专 住 拽 `geom_point`, 拽 专祝.

## 驻 住驻

注转 专 砖 爪 砖砖  砖 驻, 转 砖拽砖专  砖驻注 注 . 住祝 驻 砖  驻 爪注 砖 拽转. 住驻  转转爪注 注 专 `color=species`:

```{r penguins vis 2}
base_penguins_chart <- penguins %>% 
  ggplot(aes(x = bill_length_mm,
             y = bill_depth_mm,
             color = species)) + 
  geom_point()
```

注转 专 住驻转 爪注 转  专专  砖   **注** 砖转 `bill_length_mm`  注 砖转 `bill_depth_mm` ( 注爪 驻  砖砖 砖住转 注 转专砖  拽  砖 驻 砖).  转  砖注转转, 砖拽专转 砖驻 拽爪注转 "专拽爪". 砖 专拽爪  专 拽专   驻 砖驻注转 注 注拽 拽专. 注 专拽爪转  砖 (驻专拽 注 专专住 专转).

住祝 专祝  砖砖 拽 专专住 专转, 注专  转 拽爪转:

```{r pengions vis 3 with linear regression lines}
base_penguins_chart + 
  stat_smooth(method = "lm", se = FALSE)
```

::: callout-note
** 专 - "驻专住 住驻住":** 转驻注 砖  砖 砖注转 砖 拽砖专  砖转 砖专 住驻 专拽爪   砖 拽爪, 转专 注  住驻住 [@simpson1951].   专 砖 驻专拽住  爪 住 砖爪专 注  住爪 拽专 Datasaurus dozen [专 @murray2021].

-Datasaurus 砖转砖 住爪  爪专 砖 注砖专 拽爪转 砖驻 注爪 专转 转 驻专专 住 (爪注 爪专 x, 爪注 爪专 y, 住转 转拽, 拽专爪, '),  砖爪 转 拽转 专转 驻专, 驻   拽爪转, 拽 转 转专砖 :

```{r datasaurus dozen example}
library(datasauRus)
datasaurus_dozen %>% 
  group_by(dataset) %>% 
  summarize(mean(x),
            mean(y),
            sd(x),
            sd(y),
            cor(x, y))
datasaurus_dozen %>% 
  ggplot(aes(x = x, y = y)) + 
  geom_point() + 
  facet_wrap(~dataset)
```

转专砖  砖转砖  驻拽爪转 砖专 拽,  驻拽爪 住驻转 砖拽专转 `facet_wrap` 砖驻专拽转 转 转专砖 转转-转专砖,   爪 转 砖 拽爪 专转 (砖转 `dataset`).
:::

## 转专转 专祝 爪专

注转 驻 转 专祝 注 转专转:

```{r penguins vis 3}
pebguin_chart_w_lm <- base_penguins_chart +
  stat_smooth(method = "lm", se = FALSE) +
  xlab("Bill length [mm]") + 
  ylab("Bill depth [mm]") + 
  ggtitle("Relationship of bill length and depth in penguins", 
          subtitle = "Interaction with species (with linear regression)")

pebguin_chart_w_lm
```

## 专转 转转

转 专 转转 (Themes) 砖转 专祝 转 专转. 转 `ggplot2` 砖  转转 专转 专砖 砖转 转   注爪 转 砖. , 砖转砖 转 住 `linedraw` 专 砖 转 拽 拽专 转  拽住 砖 转专转.

```{r examples of themes}
pebguin_chart_w_lm +
  theme_linedraw() + 
  theme(legend.position = "top",
        plot.title = element_text(size = 22),
        axis.title = element_text(size = 15),
        legend.box.background = element_rect(linetype = 1, linewidth = 1))
```

::: callout-note
专 专 转 转专砖 砖 转 驻拽爪`theme` 爪注转 驻拽爪转   `element_text` (驻 拽住), `element_rect` (驻 转 专注), `element_line` (驻 拽), '. 转注 驻拽 `theme` 转 注 驻砖专转 砖转.
:::

::: callout-tip
砖转砖 驻拽 `facet_wrap` 砖 住驻转 转专砖 拽 注 转 驻爪 转  砖 转转-转专砖.  砖砖 驻拽 爪转 拽 拽 砖 驻专拽  (拽 砖住专 注 驻专拽住 住驻住).
:::

## 专转 住驻转

 住驻专 专转 住驻转 爪注 专 砖砖 转 `ggplot2`. 砖 , 住祝 驻专拽 专 砖住注    转专砖  砖转砖 驻 住 砖转  住  砖转 砖转 专爪 .

### Boxplot

专 住 Boxplot 注专转   转 爪专转 转驻转. 专 爪 "拽驻住" 砖转转 50% 转 (拽 转转 砖 拽驻住  专注 专砖, 拽 注 砖 拽驻住  专注 砖砖). 专 砖 拽驻住 爪 爪 拽拽 注 (拽 转 转爪驻转 爪-爪). 注专 拽爪,  砖, 驻注 拽转.  驻注 拽驻住 砖 住专转 住 爪, 专 注 注  砖转驻转  转驻转 专转.

爪 转 转驻转 砖拽 砖 驻 转专砖, 驻专 驻  驻,  专 爪 转 爪, 专注 砖  拽爪.

```{r boxplot example}
penguins %>% 
  ggplot(aes(y = body_mass_g, x = species)) + 
  geom_boxplot() + 
  ggtitle("Penguin weight") + 
  xlab("Species") + 
  ylab("Mass [grams]")

penguins %>% 
  filter(!is.na(body_mass_g)) %>% 
  group_by(species) %>% 
  summarize(median_mass = median(body_mass_g),
            q1_mass = quantile(body_mass_g, 0.25),
            q3_mass = quantile(body_mass_g, 0.75))
```

**  注专 拽爪?**

注专 拽爪  注 驻 注爪 驻砖专 拽砖  驻专拽, 驻 住驻专 砖. 砖 注专 拽爪 砖转 砖注转转  砖砖,   ( 专专住 砖 注 住驻专 ) 砖 砖 (爪注  砖驻注  注专 拽爪), 专  转.

注专 拽爪 砖 -1.5\*  专注 专注 专砖   专注 砖砖 注, 专 拽转 砖专 专拽转 驻转 驻 1.5   专注 ( "住专") 住 专注.

 砖 转 注 拽爪转 驻 住 Chinstrap. 专注 专砖 转拽 -3488 专, 专注 砖砖 转拽 -3950 专.   专注   462. 专   专注 驻 1.5  693.

专,  拽 砖爪转 抓 转 砖 \[3950+693, 3488-693\] 转砖 注专 专 转住 拽.

```{r extreme values}
extreme_hinges <- c(3488-693, 3950+693)
extreme_hinges
penguins %>% 
  filter(species == "Chinstrap") %>% 
  filter(body_mass_g < extreme_hinges[1] | body_mass_g > extreme_hinges[2])
```

### 爪驻驻转

转专砖 住祝 砖 住注 转 爪专转 转驻转  转专砖 砖爪 转 爪驻驻转 (转专转: 驻拽爪转 爪驻驻转  驻拽爪 砖砖 砖转转   转 驻拽爪转 转驻转.  砖 驻拽爪转 爪驻驻转  砖注转 注专 驻 注爪,  专拽  砖住 专 转转 驻拽爪转 爪驻驻转 砖 1). 爪驻驻转  专转   转驻转 住专转,   注转   (驻拽   转驻转 专转)  -转 (砖 驻拽,  专 砖 砖转 转驻转 专转),    住注    砖 转驻转 专转 砖转 转专 转. 驻拽 砖爪专转 专祝 爪驻驻转  `geom_density`.

```{r density}
penguins %>% 
  ggplot(aes(x = body_mass_g, color = species)) + 
  geom_density() + 
  ggtitle("Penguin weight: density functions") + 
  xlab("Body mass [grams]") + 
  ylab("Density")
```

   转专砖:

1.  转 专转 砖砖转 (驻专) 砖拽 祝  转专 住 Gentoo,  -Adelie 拽爪转 转专 -Chinstrap.
2.  转 专转 砖-Gentoo 砖 转驻转 -转 (砖转 注转).
3.  转 专转 砖砖  Adelie -Chinstrap 注 转驻转 住 转 砖拽 祝.

::: callout-tip
住 砖注专  拽专 转驻转 -转 驻  Gentoo. 拽 转 砖注专转 注 转专砖 转.

专 - 住   驻爪 -Gentoo 驻 砖转 住祝 爪 砖 专驻 注  专 转专 转驻转 专转 (住专转 注转 驻拽 ).
:::

### 住专

住专  专祝 住祝 砖注 爪 转驻转 砖 砖转 专爪驻, 注  砖专 砖 注专 专爪驻 注专  (拽爪转 ), 砖 专驻 拽.

 砖 住专 转转爪注 爪注转 驻拽爪 `geom_histogram`.

```{r histogram example}
penguins %>% 
  ggplot(aes(x = body_mass_g, fill = species)) + 
  geom_histogram() + 
  ggtitle("Penguin weight: histogram") + 
  xlab("Body mass [grams]") + 
  ylab("Counts [# observations]")
```

转 砖 住驻专 注转 (-bins) 注  专 砖 专 `bins=` 转 驻拽爪 `geom_histogram`. 注专 专专转   30 .

### 专

专  专祝 注转. 砖 砖转 专转 砖住注转  专祝 注转: `geom_bar` -`geom_col`.  专   砖-`geom_bar` 拽转   住驻专转, 注 砖-`geom_col` 拽转 爪专 住驻. 砖 转  砖转专转 转 住驻专 转爪驻转  住:

```{r geom bars and cols}
penguins %>% 
  ggplot(aes(species)) + 
  geom_bar() + 
  ggtitle("Number of penguins of eash species (geom_bar)")

penguins %>% 
  count(species) %>% 
  ggplot(aes(x = species, y = n)) + 
  geom_col() + 
  ggtitle("Number of penguins of eash species (geom_col)")
```

砖转 驻拽转 注 转 驻 拽.  驻 砖 注祝 转 砖砖 -`geom_col` 砖 砖转专 拽 注砖转  debug ( 砖专   砖住 驻).

专祝 专  爪  转专 砖转 ,  驻砖专 砖转砖  注 转 爪 转 转驻转 砖 砖转 住 驻拽爪 砖 砖转 专 (拽砖专  砖 砖转 ).  转 转专砖  砖爪 转 转驻转 转 砖  砖 驻拽爪 砖 专.

```{r bar plot species vs gender}
penguins %>% 
  filter(!is.na(sex)) %>% 
  count(species, sex) %>% 
  ggplot(aes(x = sex, fill = species, y = n)) + 
  geom_col(position = position_fill()) + 
  ggtitle("Distribution of species for each gender") + 
  scale_y_continuous(labels = scales::percent) + 
  ylab("Proportion [%]") + 
  xlab("Sex")
```

转 专转 转专砖 砖转驻转  砖    砖 专 转 砖 -20% 住 Chinstrap, 36% 住 Gentoo, 转专  Adelie.

驻拽爪 `position_fill` 专 砖砖 注专 转 专  注 砖  砖住转 -100%, 砖 砖转 驻砖专转 住驻转: `position_dodge`, -`position_stack`.

::: callout-tip
住 祝 转 驻拽爪 `position_fill` 驻拽爪转 专转 (`position_dodge`, `position_stack`).  拽专 转砖砖  转 驻拽爪转 ?
:::

::: callout-tip
爪专 转专砖 驻 砖 爪转 转驻转  砖 驻 驻  (驻 转 转驻拽 砖 爪专 -x  砖 注转).
:::

## 专转 转专砖

注 转 爪专 转专砖 , 注 注转 注 砖转 转:

1.   砖转  专爪 转专 转专砖 (  专爪 转专 转驻转 砖 砖转 , 拽砖专  砖 砖转,   拽砖专  砖砖 砖转)?
2.   住 砖转 砖 转专 (  专爪驻)?
3.   专转 转 砖砖 转 转专 ,  砖转 驻  ( 住拽)?

拽 1-2 注   砖 , 爪专 拽专/注住拽 砖. 砖 拽 3 转 注专 -Cheatsheet 砖 专转 Posit (砖注专 RStudio).  驻砖专   住爪  住 转专砖 专砖: [拽砖专 -Cheatsheet](https://posit.co/wp-content/uploads/2022/10/data-visualization-1.pdf).

注专 转 转  转 砖专 专 驻专拽 ,  爪 转:

-   -Boxplot 转专 拽砖专  砖 砖转: 住 砖 驻 (砖转 专爪祝) 转转  砖 驻 (砖转 ), 砖  砖转砖 -`geom_boxplot`.

-    爪驻驻转  住专 转专 拽砖专  砖 砖转 专爪祝 砖转  (专拽 爪专转 爪 砖- `geom_density`  `geom_histogram` 转).

 转 转 "  砖砖 转  注 转 转专 转驻转 砖 砖转 专爪祝 ,  注 转 转专 拽砖专  砖转   砖转 专爪祝.

-   转专砖 专 砖转砖 注 转 转专 转驻转 砖 砖转   (  驻 ),  拽砖专  转驻转 砖 砖 砖转  ( 驻   驻).

::: callout-note
###  转拽

  住驻转, 驻注  砖转专转 拽砖专  专注 砖转. 拽砖专  专 拽专, 注拽 拽专, 砖拽 砖 驻.  砖 砖砖    砖,   爪注   .

-   砖  砖砖 砖转 专爪驻 (专, 注拽, 砖拽)

-   砖  砖转  ()

-   住转转 -[Cheatsheet](https://posit.co/wp-content/uploads/2022/10/data-visualization-1.pdf) (驻 转 转转 注 专砖) 专 砖砖 住驻专 专转 转转 `geom_contour`, `geom_countour_filled`, `geom_raster`, `geom_tile`.

砖转 转 砖  砖拽,  专爪 拽专   砖驻注  拽专.  驻 转 专 注拽 拽专 爪专 x -y, 转 砖拽 爪注. 爪注转 `facet_wrap` 爪专 砖砖 转转-转专砖 (专   驻).

```{r three dimension ggplot first approach}
#| warning: false
#| message: false

penguins %>% 
  ggplot(aes(x = bill_length_mm, y = bill_depth_mm, fill = body_mass_g)) + 
  geom_raster() +
  facet_wrap(~species) +
  ggtitle("Bad example for geom_raster (due to low density)")
```

驻 砖转 专转 砖  注转 专爪,  砖砖 住转 注 转爪驻转,  驻 住  注 砖拽 砖 住 爪注. 转专砖   驻专,    转专 . 砖 专 砖 `geom_raster` 专 砖拽专 `interpolate`, 砖专 注砖转 专驻爪  拽转,    驻注 转 拽 专祝 砖砖  专专 (拽转 专拽转  转 砖).

拽专 , 驻砖专 转  "专驻爪 砖". 转  (砖转砖  专专住 专转 驻砖), 砖 专 拽专, 注拽 拽专,  驻.

```{r three dimension ggplot grid creation for a model}
#| warning: false
#| message: false

penguins_model <- lm(body_mass_g ~ bill_length_mm + bill_depth_mm + species, 
                     data = penguins)

penguin_ranges <- penguins %>% 
  group_by(species) %>% 
  summarize(across(c(bill_length_mm, bill_depth_mm), 
                   list(min = ~min(., na.rm = T),
                        max = ~max(., na.rm = T))))
```

  爪 转  专 拽专, 注拽 拽专, 砖拽, 注专    驻.

::: {style="zoom:80%; direction:ltr;"}
```{r a scaled down gt}
gt::gt(penguin_ranges)
```
:::

砖转砖 转   转  砖 砖 爪  注专 驻砖专,  砖 注 住住  专专住 住转 砖.

```{r three dimension ggplot with a model}
step <- 0.5
penguin_grid <- 
  expand_grid(length = seq(32.1, 46, step),
              depth = seq(15.5, 21.5, step),
              species = "Adelie") %>% 
  bind_rows(
    expand_grid(length = seq(40.9, 58, step),
                depth = seq(16.4, 20.8, step),
                species = "Chinstrap"),
    expand_grid(length = seq(40.9, 59.6, step),
                depth = seq(13.1, 17.3, step),
                species = "Gentoo")
  ) %>% 
  rename(bill_length_mm = length,
         bill_depth_mm = depth)

penguin_grid$body_mass_g <- predict(penguins_model, newdata = penguin_grid)

penguin_grid %>% 
  ggplot(aes(x = bill_length_mm, y = bill_depth_mm, fill = body_mass_g)) + 
  geom_raster(interpolate = TRUE) + 
  scale_fill_viridis_c() + 
  facet_wrap(~species) + 
  ggtitle("Bill length, depth, and mass for various species", subtitle = "Based on a linear regression model")
```

注转 转 爪 驻专砖转  注  注 专祝. 专 砖住 驻 砖驻注 转专 注 砖拽: -Gentoo 砖拽  转专, 转拽 砖专 专 注拽 砖 拽专 注 (驻 转 注 砖 转专砖 ). 驻专 砖 驻  -Chinstrap  转 注  拽专 ,  注  注 转 砖拽 驻 砖爪驻 -Gentoo.

 拽专 注  拽专 (注拽 专) 爪注 注 注 砖拽 (  驻 注 转   转转 转专砖 爪注转 爪注 转专 专).
:::

## 住

驻专拽   驻拽 转专砖 爪注转 转 `ggplot2`.  转 砖   转专 砖住住转 转 (the grammar of graphics),  爪 砖 转 转专砖 (爪注转 驻, 专转, 专转 住驻转).

专 转 专转 住转  boxplot, 住专, 爪驻驻转, 专祝 专.

住祝 专 爪 转 转 转专砖 爪注转  砖 住 砖转 拽砖专 砖 专爪 转, 专  转专砖 砖专 拽砖专  专注 砖转 砖, 住住 注  砖 专专住 专转.

::: end-page
