# רגרסיה לינארית {#sec-linear-regression}

בפרק זה נדון באחד המודלים הבסיסיים בסטטיסטיקה: רגרסיה לינארית.

רגרסיה (regression) היא שם כולל למודלים אשר מתאימים בין משתנים בלתי תלויים (המסומנים ב-x בדרך כלל, ונקראים גם משתנים מסבירים), לבין משתנה תלוי (המסומן ב-y בדרך כלל). רגרסיה לינארית הינה סוג מסוים של רגרסיה המניח קשר לינארי בין המשתנה התלוי לבין המשתנים הבלתי תלויים.

כאמור, בפרק זה איננו מתעמקים בתיאוריה הסטטיסטית, ולצורך העמקת הרקע הסטטיסטי שנוגע לבעיות רגרסיה, מומלץ לעיין בספר מתאים [לדוגמה @walpole1993probability]. עם זאת, נציין שמודל הרגרסיה הלינארית מוצא את מקדמי ה-$\beta$ שקושרת בין המשתנה התלוי למשתנים המסבירים: $$
y=\beta_0 + \beta_1 x_1 + \beta_2 x_2 + \ldots + \beta_p x_p
$$

המקדמים שמביא מודל הרגרסיה הלינארית מביאים למינימום את **סכום ריבועי השגיאות**, אשר נמחיש בהמשך הפרק.

::: callout-note
באופן כללי נציין שיש אבחנה בין בעיות רגרסיה בהן המשתנה התלוי מקבל ערכים רציפים (ערך ממשי), לבין בעיות סיווג (Classification), בהם המשתנה התלוי מקבל ערך קטגוריאלי. נדון באבחנה זו ובדוגמאות נוספות של מודלים בפרק הבא.
:::

```{r setup}
#| include: false
#| 
ggplot2::theme_set(ggplot2::theme_bw())
```

נדגים שימוש בגרסיה לינארית באמצעות הדאטה שעמו עבדנו עד כה, שבו תצפיות של פינגוינים (`palmerpenguins::penguins`). כפי שראינו בפרקים קודמים (ראו לדוגמה ב[פרק @sec-ggplot2] תחת "מיפויים נוספים"), הקשרים שבין המשתנים שבדאטה תלויים גם בסוג הפינגויין, ולכן נתחיל בהסתכלות על הקשר שבין עומק המקור לאורך המקור בזן Adelie בלבד.

התרשים הבא מציג את פיזור התצפיות בין עומק מקור לאורך המקור, וכמו כן מציג רגרסיה לינארית "פשוטה" (כלומר רגרסיה שבה יש משתנה בלתי תלוי יחיד).

המשתנה התלוי בציר x (אורך המקור), והמשתנה הבלתי-תלוי בציר y (עומק המקור). במקרה זה הבחירה במה יהיה המשתנה התלוי ומה המשתנה הבלתי תלוי היא בחירה שרירותית, אז בדרך כלל זהו אינו המצב (ראו הסבר במסגרת שלאחר התרשים).

את קו הרגרסיה אנחנו מוסיפים באמצעות הפקודה `stat_smooth(method="lm")` , אשר מוסיפה לתרשים פיזור החלקה, במקרה זה בשיטה של רגרסיה לינארית (lm זה קיצור של linear model). הרקע האפור מסביב לקו הלינארי של הרגרסיה מהווה רווח בר סמך למודל הרגרסיה (מיד נדון במשמעויות שלו).

```{r adelie plot}
#| warning: false
#| message: false
#| include: true

library(palmerpenguins)
library(tidyverse)

adelie_penguins <- penguins %>% 
  filter(species == "Adelie") %>% 
  filter(!is.na(bill_length_mm), !is.na(bill_depth_mm))

adelie_penguins %>%
  ggplot(aes(x = bill_length_mm, y = bill_depth_mm)) + 
  geom_point() + 
  stat_smooth(method = "lm") + 
  ggtitle("Relationship of bill depth and bill length among Adelie penguins",
          subtitle = "Linear model applied")

```

על פי ההמחשה הויזואלית של קו הרגרסיה, נראה שיש קשר חיובי בין עומק המקור לבין אורך המקור (כאשר עולה האורך, כך עולה גם העומק של המקור). על מנת לקבל את מודל הרגרסיה ניתן להשתמש בפקודה `lm` באופן הבא:

```{r demonstration of lm}
adelie_lm <- lm(formula = bill_depth_mm ~ bill_length_mm,
                data = adelie_penguins)

summary(adelie_lm)
```

השתמשנו בפקודה `summary` שיודעת לקבל אובייקטים שונים (במקרה הזה אובייקט שהוא תוצר של מודל לינארי), ולהציג סיכום שלו הכולל את מקדמי המודל, המובהקויות, וכן מימדים נוספים כגון $r^2$, וסטטיסטי F, שמיד נסביר עליהם.

## פלט הפקודה `lm`

כעת נתעמק ונסביר את פלט הפקודה.

TBD.

## סכום ריבועי השגיאות

TBD.

## בדיקת הנחות הרגרסיה

הומוסקדסטיות, והתפלגות נורמלית של השאריות.

TBD.

## סידור פלט הפקודה

נציין שישנה דרך לחלץ את נתוני המקדמים של המודל כאובייקט tibble על ידי שימוש בפקודה `broom::tidy` באופן הבא (בדומה לשימוש בפקודה זו שראינו בפרק הקודם):

```{r demonstration of tidy}
broom::tidy(adelie_lm)
```

ישנן פקודות שונות שניתן להשתמש בהן על מנת להדפיס את תוצאות הרגרסיה בטבלה מסודרת (כזו שתתאים לפרסום), לדוגמה:

::: {style="direction: ltr;"}
```{r gt example linear regression}
#| warning: false
gtsummary::tbl_regression(adelie_lm)
```
:::

חבילות נוספות הינן `stargazer` לטבלאות, ו-`jtools` לויז'ואליזציות. \
לא נדון בחבילות אלו בפרק זה, אך הקורא המעוניין מוזמן להתעמק בחבילות וביכולות.

::: end-page
