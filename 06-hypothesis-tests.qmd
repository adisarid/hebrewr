# מבחני השערות {#sec-hypothesis-tests}

בפרק זה נלמד על מבחני השערות פשוטים שניתן להפעיל ב-R. מטבע הדברים, מכיוון ש-R היא שפה סטטיסטית יש ערב רב של מבחני השערות פרמטרים וא-פרמטריים, שבוחנים השערות שונות במצבים שונים, אבל בספר זה נתמקד במבחני ההשערות שיימצאו בקורס מבוא לסטטיסטיקה (ואולי עוד קצת).

מטרת הפרק היא לא לספק את התיאוריה. לצורך השלמות תיאורתיות, אני ממליץ לקרוא את [@walpole1993probability].

מטרת הפרק שלפניכם היא לתת כלים מעשיים לביצוע מבחני השערות, בפרט נדון במקרים הבאים:

-   מבחני השערות על תוחלת

-   מבחני השערות על שונות

-   מבחני השערות על אי-תלות

-   מבחני השערות על התפלגות

## מבחני השערות על תוחלת

אחד מהפרמטרים החשובים של התפלגויות הוא התוחלת. לתוחלת ולממוצע יש קשר הדוק ביניהם - כאשר אנחנו מבצעים דגימה מתוך אוכלוסיה, ממוצע המדגם הוא אמד המייצג את התוחלת.

```{r setup}
#| warning: false
#| message: false
#| include: false

library(palmerpenguins)
library(tidyverse)
```

נדגים זאת בעזרת מדגם הפינגויינים שראינו בפרק הקודם:

```{r penguin means}
penguins %>% 
  filter(!is.na(bill_length_mm)) %>% 
  group_by(species) %>% 
  summarize(avg_length = mean(bill_length_mm),
            sample_size = n())
```

לכל אחד מזני הפינגויינים ממוצע שונה לאורך המקור. לדוגמה, פינגויינים מסוג Adelie הם בעלי מקור באורך ממוצע 38.8 מ"מ. בפועל מדובר בממוצע המחושב על מדגם של 151 תצפיות, וסביר להניח שהתוחלת בכלל אוכלוסית הפינגויים מזן Adelie היא קצת שונה. לדוגמה, תוחלת של 38 מ"מ, יכולה להביא לכך שממוצע על פני דגימה של 151 תצפיות יהיה 38.8 מ"מ.

המטרה של מבחן השערות על התוחלת היא לעזור לנו לקבוע ברמת שגיאה של $\alpha$ (אשר בדרך כלל נקבעת כ-5% שגיאה), *האם התוחלת היא בעלת ערך מסוים* $\mu_0$, *בהינתן תוצאות המדגם* שלנו.

צורת הסתכלות אחרת היא בניית רווח בר סמך לתוחלת, או במילים אחרות, *מה הטווח הסביר שבו נמצאת התוחלת בהינתן תוצאות המדגם*.

בשלב זה נתייחס למדגם אחד, ומיד נכליל את ההסתכלות לשני מדגמים.

### מבחן השערות על מדגם אחד

התרשים הבא מציג את התפלגות אורך המקור של פינגויינים מזן Adelie באמצעות היסטוגרמה.

על ההיסטוגרמה הלבשנו שני קווים אנכיים: הממוצע בפועל בירוק (38.3913), והערך שאותו נבחן כתוחלת (38) באמצעות מבחן השערות.

```{r adelie bill length histogram}
adelie <- penguins %>% 
  filter(species == "Adelie") %>% 
  filter(!is.na(bill_length_mm))

ggplot(adelie, aes(x = bill_length_mm)) + 
  geom_histogram(bins = 15) + 
  geom_vline(xintercept = 38, color = "#E41A1C", linewidth = 1, linetype = 2) + 
  geom_vline(xintercept = mean(adelie$bill_length_mm), color = "#4DAF4A", linewidth = 1) + 
  ggtitle("Distribution of Adelie bill length")
```

נשתמש בפקודת `t.test` על מנת לייצר רווח בר סמך (או מבחן השערות) לתוחלת אורך המקור של פינגויינים מזן Adelie.

נבנה את רווח בר הסמך ברמת ביטחון של 95% (כלומר רמת הוודאות של הדיווח שנקבל היא 95%, או 5% שגיאה). כמו כן, נבחן האם ייתכן שהתוחלת הינה 38, למרות שהתצפיות במדגם בעלות ממוצע של 38.8.

```{r adelie ttest}
t.test(adelie$bill_length_mm, 
       alternative = "two.sided",
       mu = 38, conf.level = 0.95)
```

**פרשנות תוצאות המבחן: אנו דוחים את השערת ה-0 שהתוחלת הינה 38.** להלן הסבר מפורט לפלט:

1.  בראש הפלט מופיע סוג המבחן שהופעל (One Sample t-test), כלומר מבחן t עבור מדגם יחיד (יש גם מבחנים עבור שני מדגמים מזווגים, ושני מדגמים לא-מזווגים, מיד נדגים).
2.  בשורה השניה מופיע הדאטה שבו השתמשנו.
3.  בשורה השלישית ההשערה האלטרנטיבית שנבחנה (המכונה $H_1$ . במקרה זה הגדרנו בארגומנט `alternative` מבחן השערה דו-צדדי, כלומר: $H_1: \mu\neq38$.
4.  בשורה הרביעית ערך $T$ של המבחן (המכונה גם סטטיסטי המבחן), במקרה זה ערכו הוא 3.6513, ובנוסף מספר דרגות החופש (df), וערך המובהקות (p-value). ערך p-value במקרה זה הינו מתחת ל-0.05 מה שמעיד על כך שעלינו לדחות את השערת ה-0 ($H_0: \mu=38$).
5.  בשורה הבאה (ובזו שאחריה) מופיע הרווח בר סמך לתוחלת. במקרה זה הרווח בר סמך ברמת בטחון של 95% מעיד על כך שתוחלת אורך המקור של הפינגויין מהזן הנבחן נמצאת בין 38.36 לבין 39.22. ניתן לשים לב שהתוחלת אותה בחנו בהשערת ה-0 (\$\\mu=38\$) נמצאת מחוץ לטווח זה, וזה עולה בקנה אחד עם הדחיה שתיארנו בסעיף קודם בהתייחס לערך ה-p-value.
6.  לבסוף מופיע הממוצע עצמו של המשתנה (38.7914).

<div class="question">

היעזרו בתיעוד הפקודה `t-test` ושנו את הארגומנט `alternative` על מנת לבצע את המבחן הסטטיסטי:

$$
H_0: \mu=38\\
H_1: \mu>38
$$

מה תוצאת המבחן? מה המסקנה?

</div>

## שני מדגמים לא-מזווגים

כעת נפנה למבחן t-test שבו נשתמש כאשר ברצוננו להשוות בין שני מדגמים, לא מזווגים. לדוגמה על מנת לבחן האם ניתן לדחות את ההשערה שאורך המקור של פינגויינים מזן Chinstrap ואורך המקור של פינגויינים מזן Gentoo שווים (כפי שראינו ערכיהם דומים יחסית).

ראשית, נציג את ההתפלגות של שני הזנים בתרשים הבא:

```{r distribution of chinstrap and gentoo bill length}
chin_gentoo <- penguins %>% 
  filter(!is.na(bill_length_mm)) %>% 
  filter(species != "Adelie")

ggplot(chin_gentoo,
       aes(x = bill_length_mm, color = species)) + 
  geom_density() + 
  ggtitle("Distribution of Chinstrap and Gentoo bill length")
```

כעת נשתמש בפקודה `t-test` אך בצורת הפעלה מעט שונה מזו שבה השתמשנו במקרה של מדגם יחיד.

```{r two sample ttest}
t.test(formula = bill_length_mm ~ species,
       data = chin_gentoo)
```

צורת ההפעלה שבה השתמשנו מגדירה נוסחה ודאטה. הנוסחה היא `bill_length_mm ~ species`, כלומר בחן את אורך המקור לפי המשתנה species (במקרה זה, חייבים שלמשתנה המסביר `species` יהיו בדיוק שתי רמות, אחרת נקבל שגיאה).

**קיבלנו דחיה של השערת ה-0, כלומר ניתן לדחות את ההשערה שתוחלת אורך המקור בין שני הזנים שווה.** ברמת מובהקות של 0.00773.

הרווח בר סמך מתייחס להפרש בין התוחלות, קרי, ברמת ביטחון של 95% ההפרש בין התוחלות נע בין 0.357 לבין 2.301 (לטובת Chinstrap שבעלי אורך מקור גדול יותר).

הפקודה שהרצנו משתמשת במבחן המניח שונות שונה, ניתן לשנות זאת על ידי הוספת הארגומנט `var.equal=TRUE`.

```{r two sample ttest non equal variance}
t.test(formula = bill_length_mm ~ species,
       data = chin_gentoo,
       var.equal = TRUE)
```
